

SELECT lg_rider_id, 
    --created_date_local, 
    EXTRACT(YEAR FROM DATE(created_date_local)) AS rider_accepted_year_local,
    EXTRACT(MONTH FROM DATE(created_date_local)) AS rider_accepted_month_local,
    SUM(working_time_in_seconds/3600) AS working_time_in_hour, 
    SUM(all_shift_count) AS all_shift_count,
    SUM(delivery.completed_deliveries_count) AS completed_deliveries_count,
    SUM(delivery.pickup_distance_sum_in_meters) AS pickup_distance_sum_in_meters,
    SUM(delivery.dropoff_distance_sum_in_meters) AS dropoff_distance_sum_in_meters,
    SUM(delivery.pickup_distance_sum_in_meters + delivery.dropoff_distance_sum_in_meters)/1000 AS total_distance_in_km
FROM `fulfillment-dwh-production.pandata_curated.lg_daily_rider_zone_kpi` rider,
    UNNEST(deliveries_by_entity) delivery
WHERE created_date_local >= "2021-02-01" AND global_entity_id = "FP_KH" 
    AND lg_rider_id IN (
        584722,
        661178,
        231299,
        293859,
        586680,
        705524,
        754199,
        771722,
        721434,
        651078,
        627998,
        529224,
        318179,
        717834,
        735934,
        773194,
        687142,
        779473,
        661198,
        503022,
        626896,
        405826,
        742171,
        689183,
        753342,
        569641,
        693075,
        761619,
        854101,
        660565,
        663059,
        544238,
        791789,
        340846,
        542151,
        942843,
        698630,
        787624,
        626918,
        737315,
        309953,
        705126,
        859280,
        539422,
        598964,
        497006,
        521408,
        996239,
        995726,
        778897,
        665415,
        712113,
        690915,
        686950,
        701652,
        505307,
        507615,
        698928,
        457302,
        947142,
        508034,
        486236,
        437803,
        773009,
        947142,
        918516,
        454442,
        775984,
        1011220,
        914309,
        712102,
        282521,
        947460,
        531081,
        282521,
        920662,
        968755,
        953757,
        999000,
        969897,
        628266,
        753694,
        1021248,
        914426,
        791944,
        1041443,
        1066225,
        613911,
        1038744,
        1058788,
        835403,
        773885,
        721434,
        642557,
        741197,
        972274,
        651078,
        1014887,
        1067425,
        989292,
        964533,
        504794,
        1088153,
        472378,
        779468,
        1030380,
        259698,
        733662,
        1118697,
        1121655,
        919815,
        877851,
        1086098,
        1113931,
        771737,
        1125420
    ) 
GROUP BY 1,2,3 ORDER BY rider_accepted_month_local DESC

